(this.webpackJsonptodos=this.webpackJsonptodos||[]).push([[0],{177:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),r=a(84),i=a(20),d=a(14),o=a(22),l=a(21),c=a(23),u=a(12),p=a(52);var m=function(e,t,a){var s,n=(s={credentials:"include",method:t},Object(p.a)(s,"credentials","omit"),Object(p.a)(s,"headers",{"Content-Type":"application/json",Accept:"application/json",Authorization:window.token}),s);return"GET"!==t&&"DELETE"!==t&&(n.body=JSON.stringify(a)),fetch(window.api+e,n).then((function(e){if(200!==e.status&&201!==e.status&&204!==e.status){var a=new Error("Request failed");throw a.json=e.json(),a}return"DELETE"!==t?e.json():e}))};var h=function(e,t){return m("proxy-bindings","POST",{data:{type:"proxy_bindings",attributes:{real_addresses:[e],proxy_address:t}}})};var b=function(e,t){return m("users","POST",{data:{type:"users",attributes:{username:e,password:t}}})},y=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={},a.parent=e.parent,a.submitHandle=a.submitHandle.bind(Object(u.a)(a)),a.submitHandlePassword=a.submitHandlePassword.bind(Object(u.a)(a)),a.parent.proxyBindingCreateComponent=Object(u.a)(a),a.lastRealAddress="",a.map={},a}return Object(c.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.message="",this.proxiedAddress="",this.realAddress="",this.proxiedAddress="",this.enterPasswordMode=0,this.password="",this.state.lastRealAddress=this.parent.proxyCreateBindingState.lastRealAddress,this.forceUpdate()}}]),Object(d.a)(t,[{key:"submitHandle",value:function(e){var t=this;e.preventDefault(),document.getElementById("message").style.display="none";var a=document.getElementById("real-address").value,s=document.getElementById("proxied-address").value;0!==a.length&&0!==s.length&&(s+="@proxiedmail.com","mainpage"!==window.mode?h(a,s).then((function(e){t.parent.rerender(e.data),document.getElementById("real-address").value="",document.getElementById("proxied-address").value="",t.proxiedAddress="",t.forceUpdate()})):(this.realAddress=a,this.proxiedAddress=s,document.getElementById("real-address").value="",document.getElementById("proxied-address").value="",this.enterPasswordMode=1,this.forceUpdate()))}},{key:"submitHandlePassword",value:function(e){var t=this;e.preventDefault();var a=document.getElementById("password").value;0!==a.length&&(this.password=a,this.forceUpdate(),b(this.realAddress,this.password).then((function(e){var a=e.data.attributes.token;window.token="Bearer "+a,h(t.realAddress,t.proxiedAddress).then((function(e){window.location.href="/en/redirect?token="+a+"&to=/en/board?signup_conversion=1"}))})).catch((function(e){window.location.href="/en/signin?email="+encodeURIComponent(t.realAddress)})))}},{key:"error",value:function(e){setTimeout((function(){document.getElementById("message").style="dispaly:block"}),200),this.message=e}},{key:"changeHandle",value:function(){var e=document.getElementById("proxied-address");if(e){var t=e.value;this.proxiedAddress=t,this.forceUpdate()}}},{key:"makeid",value:function(e){for(var t="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=a.length,n=0;n<e;n++)t+=a.charAt(Math.floor(Math.random()*s));return t}},{key:"onKeyDown",value:function(e){var t=e||window.event,a=t.charCode?t.charCode:t.which;if(this.map[a]="keydown"==t.type,!0===this.map[16]&&!0===this.map[50])return e.preventDefault(),!1}},{key:"generateRandomAddress",value:function(e){e.preventDefault();var t=this.makeid(10).toLowerCase();document.getElementById("proxied-address").value=t,this.changeHandle()}},{key:"onTodoChange",value:function(e){this.setState({lastRealAddress:e})}},{key:"render",value:function(){var e=this,t=this.password&&this.password.length>0?{display:"block"}:{display:"none"},a=this.password&&this.password.length>0?{display:"none"}:{display:"block"};return this.enterPasswordMode?n.a.createElement("div",null,n.a.createElement("form",{className:"create__form",onSubmit:this.submitHandlePassword},n.a.createElement("div",{className:"create__form-inner"},n.a.createElement("div",{className:"spinner-border",role:"status",id:"loader",style:t},n.a.createElement("span",{className:"sr-only"},"Loading...")),n.a.createElement("div",{style:a},n.a.createElement("p",{className:"lead"},"Your email: ",n.a.createElement("i",null,this.realAddress)),n.a.createElement("p",{className:"lead"},"To finish adding proxy, please choose password to manage it."),n.a.createElement("br",null),n.a.createElement("div",{className:"form__proxiedmailaddress"},n.a.createElement("label",{className:"form__title",htmlFor:"real-address"},"Password"),n.a.createElement("br",null),n.a.createElement("input",{type:"password",style:{margin:0},className:"form__input",id:"password",placeholder:"Password"})),n.a.createElement("button",{id:"proceed",type:"submit",className:"form__btn btn"},"Finish"))))):n.a.createElement("div",null,n.a.createElement("div",{className:"alert alert-warning",id:"message",style:{display:"none"},role:"alert"},this.message),n.a.createElement("form",{className:"create__form",onSubmit:this.submitHandle},n.a.createElement("div",{className:"create__form-inner"},n.a.createElement("div",{className:"form__realaddress"},n.a.createElement("div",{className:"form__title",for:"real-address"},"Real address"),n.a.createElement("input",{type:"text",id:"real-address",value:this.state.lastRealAddress,onChange:function(t){return e.onTodoChange(t.target.value)},placeholder:"John@gmail.com"})),n.a.createElement("div",{className:"form__proxiedmailaddress"},n.a.createElement("div",{className:"form__title",style:{},htmlFor:"password"},"ProxiedMail Address ",this.proxiedAddress,"@proxiedmail.com"),n.a.createElement("button",{className:"form__proxiedmailaddress-btn light__btn",onClick:this.generateRandomAddress.bind(this)},"Generate random address"),n.a.createElement("input",{type:"input",onKeyDown:this.onKeyDown.bind(this),onKeyUp:this.onKeyDown.bind(this),onChange:this.changeHandle.bind(this),className:"form__input",id:"proxied-address",placeholder:"Proxied Email (example: john)"}),n.a.createElement("button",{id:"proceed",type:"submit",className:"form__btn btn btn-primary"},"Create")))))}}]),t}(n.a.Component);var g=function(){return m("proxy-bindings","GET",{})};var f=function(e){return m("proxy-bindings/"+e,"DELETE",{})};var v=function(e,t,a){return m("proxy-bindings/"+e,"PATCH",{data:{id:e,type:"proxy_bindings",attributes:{real_addresses:t,proxy_address:a}}})},E=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).isLoaded=0,a.props=e,a.bindings=[],a.props.parent.proxyBindingsListComponent=Object(u.a)(a),a}return Object(c.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){"mainpage"!==window.mode?this.load():(this.isLoaded=1,this.forceUpdate())}},{key:"load",value:function(){var e=this;this.bindings=g().then((function(t){if(e.bindings=t.data,e.props.state.proxyBindings=e.bindings,e.bindings.length>0){var a=e.bindings[e.bindings.length-1],s=Object.keys(a.attributes.real_addresses).length;console.log(s),e.props.parent.proxyCreateBindingState.lastRealAddress=Object.keys(a.attributes.real_addresses)[s-1],e.props.parent.proxyBindingCreateComponent.componentDidMount()}e.isLoaded=1,e.forceUpdate()}))}},{key:"remove",value:function(e,t){var a=this;if(1===Object.keys(e.attributes.real_addresses).length)f(e.id),this.props.state.proxyBindings=this.props.state.proxyBindings.reduce((function(t,a){return e.id!==a.id&&t.push(a),t}),[]),this.forceUpdate();else{var s=Object.keys(e.attributes.real_addresses).reduce((function(a,s){return console.log(t,s),s!==t&&(a[s]=e.attributes.real_addresses[s]),a}),[]);console.log(s),v(e.id,s,e.attributes.proxy_address,!0).then((function(t){a.props.state.proxyBindings=a.props.state.proxyBindings.reduce((function(a,s){return e.id!==t.data.id?a.push(s):a.push(t.data),a}),[])}))}}},{key:"changeStatus",value:function(e,t){var a=this,s=e.attributes.real_addresses;s[t]=!e.attributes.real_addresses[t],v(e.id,s,e.attributes.proxy_address).then((function(e){a.props.state.proxyBindings=a.props.state.proxyBindings.reduce((function(t,a){return console.log(),a.id!==e.data.id?t.push(a):t.push(e.data),t}),[]),a.forceUpdate()}))}},{key:"render",value:function(){var e,t,a=this;return e=0===this.props.state.proxyBindings.length?{display:"none"}:{display:"table"},t=0===this.isLoaded?{display:"table"}:{display:"none"},n.a.createElement("div",null,n.a.createElement("div",{className:"spinner-border",role:"status",id:"loader",style:t},n.a.createElement("span",{className:"sr-only"},"Loading...")),n.a.createElement("table",{className:"table",id:"table",style:e},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",{scope:"col"},"Real email"),n.a.createElement("th",{scope:"col"},"Proxy Email"),n.a.createElement("th",{scope:"col"},"Received Emails"),n.a.createElement("th",{scope:"col"},"Manage"))),n.a.createElement("tbody",null,this.props.state.proxyBindings.map((function(e,t){return Object.keys(e.attributes.real_addresses).map((function(t){return n.a.createElement("tr",null,n.a.createElement("td",null,t),n.a.createElement("td",null,e.attributes.proxy_address),n.a.createElement("td",null,e.attributes.received_emails," (",e.attributes.real_addresses[t]?n.a.createElement("font",{style:{color:"green"}},"Enabled"):n.a.createElement("font",{style:{color:"red"}},"Disabled"),")"),n.a.createElement("td",null,n.a.createElement("button",{type:"button",className:"btn btn-sm btn-danger pb-remove",onClickCapture:function(s){return a.remove(e,t)},style:{"font-size":"11px"}},"Remove"),n.a.createElement("button",{type:"button",className:e.attributes.real_addresses[t]?"btn btn-sm btn-secondary pb-status-change":"btn btn-sm btn-success pb-status-change",onClickCapture:function(s){return a.changeStatus(e,t)},style:{"margin-left":"4px","font-size":"11px"}},e.attributes.real_addresses[t]?"Disable":"Enable"),n.a.createElement("hr",null)))}))})))))}}]),t}(n.a.Component),x=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).state={proxyBindings:[]},a.proxyCreateBindingState={lastRealAddress:""},a.proxyBindingCreateComponent=null,a}return Object(c.a)(t,e),Object(d.a)(t,[{key:"rerender",value:function(e){var t=Object.keys(e.attributes.real_addresses).length;if(t>1){var a=e.attributes.real_addresses;e.attributes.real_addresses[Object.keys(a)[t-1]]=Object.values(a)[t-1]}t>1?(console.log(t,e.attributes.real_addresses),this.state.proxyBindings=this.state.proxyBindings.reduce((function(t,a){return a.id===e.id?t.push(e):(console.log(a),t.push(a)),t}),[]),console.log(this.state.proxyBindings)):(console.log("t"),this.state.proxyBindings.push(e)),this.proxyBindingsListComponent.load(),this.forceUpdate()}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement(E,{state:this.state,parent:this}),n.a.createElement(y,{parent:this,state:this.proxyCreateBindingState}))}}]),t}(n.a.Component);window.api||(window.api="http://localhost:904/api/v1/"),Object(r.render)(n.a.createElement(x,null),document.getElementById("root"))},85:function(e,t,a){e.exports=a(177)}},[[85,1,2]]]);
//# sourceMappingURL=main.c0822e76.chunk.js.map