(this.webpackJsonptodos=this.webpackJsonptodos||[]).push([[0],{184:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),i=r(86),s=r(6),o=r(7),c=r(4),l=r(8),u=r(9),p=r(13),h=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.props.error.length<1?n.a.createElement("div",null):n.a.createElement("div",{className:"form__text-error active"},n.a.createElement("span",null,"!"),this.props.error)}}]),t}(n.a.Component),d=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e;return"numeric"===this.props.step.type&&(e="Tip: lick on the number to edit manually"),"undefinded"!==typeof this.props.step.description&&(e=this.props.step.description),n.a.createElement("div",{className:"form__main-title"},n.a.createElement("h2",null,this.props.step.title,n.a.createElement("span",{style:this.props.step.required?{}:{fontSize:"10px"}},this.props.step.required?"*":"(optional)"),n.a.createElement("div",{style:{fontSize:"12px",color:"#CCC",lineHeight:"20px"}},e)))}}]),t}(n.a.Component),m=function(e){function t(e){var r;Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=r.handleChange.bind(Object(p.a)(r));r.props.config.variants;var a=r.props.parent.getCurrentValue();return null!==a&&a.length>0&&(r.props.config.variants=r.props.config.variants.reduce((function(e,t){return t.checked=a===t.value,t.showMyVariant=!1,console.log(t,a),void 0!==t.title&&(t.showMyVariant=a===t.value),e.push(t),e}),[])),r.forceUpdate(),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"handleOnClick",value:function(e){var t=this;if(null!==e.value&&!e.custom)return this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.value}),void this.props.parent.dispatch({type:"nextStep",step:this.props.config,value:e.value});this.props.config.variants;this.props.config.variants=this.props.config.variants.reduce((function(r,a){return a.showMyVariant?(a.value="",a.showMyVariant=!1,r.push(a),r):a.title===e.title&&!e.showMyVariant&&e.custom?(a.checked=!0,a.showMyVariant=!0,a.value="",r.push(a),t.props.parent.dispatch({type:"changeCurrentValue",currentValue:""}),r):(a.checked=e.value===a.value,r.push(a),r)}),[]),this.forceUpdate()}},{key:"handleChange",value:function(e){this.props.config.variants=this.props.config.variants.reduce((function(t,r){return void 0!==r.title&&(r.value=e.target.value),t.push(r),t}),[]),this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return console.log(this.props.config),n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},n.a.createElement("div",{className:"from__group-radio"},this.props.config.variants.map((function(t){return console.log(void 0!==t.showMyVariant&&!1!==t.showMyVariant),n.a.createElement("div",null,n.a.createElement("input",{checked:t.checked,type:"radio",value:t.value,name:t.title,id:t.title}),n.a.createElement("label",{onClick:function(){return e.handleOnClick(t)},htmlFor:t.title},void 0!==t.custom?t.title:t.value),n.a.createElement("input",{onChange:e.handleChange,value:e.props.parent.getCurrentValue(),style:void 0!==t.showMyVariant&&!1!==t.showMyVariant?{display:"block"}:{display:"none"},type:"text",placeholder:"My variant"}))})))),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),f=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=r.handleChange.bind(Object(p.a)(r)),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){this.nameInput.focus()}},{key:"handleChange",value:function(e){this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},n.a.createElement("input",{ref:function(t){e.nameInput=t,null!==t&&t.focus()},type:"text",onChange:this.handleChange,placeholder:this.props.config.placeholder,value:this.props.parent.getCurrentValue()})),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),v=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=r.handleChange.bind(Object(p.a)(r)),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){this.props.config.variants=this.props.config.variants.reduce((function(t,r){return void 0!==r.title&&r.custom&&(r.value=e.target.value),t.push(r),t}),[]),this.forceUpdate()}},{key:"handleOnClick",value:function(e){var t=this,r=[];this.props.config.variants=this.props.config.variants.reduce((function(a,n){return e.value===n.value&&n.checked?(e.custom&&(t.myVariant="",e.showMyVariant=!1),n.checked=0,a.push(n),a):(n.checked&&r.push(n.value),e.value===n.value?(n.checked=1,void 0!==n.custom&&n.custom&&e.custom&&n.checked&&(n.showMyVariant=!0),r.push(n.value),a.push(n),a):(a.push(n),a))}),[]),console.log(r),this.props.parent.dispatch({type:"changeCurrentValue",currentValue:r}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},this.props.config.variants.map((function(t){var r;return n.a.createElement("div",{className:"from__group-radio"},n.a.createElement("input",{checked:t.checked,type:"checkbox",value:t.value,name:t.title,id:t.value}),n.a.createElement("label",{onClick:function(){return e.handleOnClick(t)},htmlFor:t.title},void 0!==t.custom?t.title:t.value),n.a.createElement("input",{onChange:e.handleChange,value:null!==(r=t.value)&&void 0!==r?r:"",style:void 0!==t.showMyVariant&&!1!==t.showMyVariant?{display:"block"}:{display:"none"},type:"text",placeholder:"My variant"}))}))),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),b=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).handleChange=r.handleChange.bind(Object(p.a)(r)),r.increment=r.increment.bind(Object(p.a)(r)),r.decrement=r.decrement.bind(Object(p.a)(r)),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"handleChange",value:function(e){0===this.props.parent.getCurrentValue()&&(e.target.value=e.target.value.replace("0","")),this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"increment",value:function(){this.props.parent.dispatch({type:"changeCurrentValue",currentValue:this.props.parent.getCurrentValue()+1}),this.forceUpdate()}},{key:"decrement",value:function(){var e=this.props.parent.getCurrentValue();e<=0||(this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e-1}),this.forceUpdate())}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group form__group--calc"},n.a.createElement("button",{className:"form__btn-calc",onClick:this.decrement,type:"button"},"-"),n.a.createElement("input",{ref:function(t){e.nameInput=t,null!==t&&t.focus()},className:"form__input-calc",type:"text",onChange:this.handleChange,value:this.props.parent.getCurrentValue()}),n.a.createElement("button",{className:"form__btn-calc",onClick:this.increment,type:"button"},"+")),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),g=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).value="",r.props.state.subscribe((function(){return r.props.state.getState()})),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(e){var t,r=this.props.step;switch(r.type){case"input":t=n.a.createElement(f,{config:r,parent:this});break;case"single-choice":t=n.a.createElement(m,{config:r,parent:this});break;case"multiple-choice":t=n.a.createElement(v,{config:r,parent:this});break;case"numeric":t=n.a.createElement(b,{config:r,parent:this})}return n.a.createElement("div",null,t)}},{key:"getError",value:function(){return this.props.state.getState().error}},{key:"dispatch",value:function(e){this.props.state.dispatch(e)}},{key:"getCurrentValue",value:function(){return this.props.state.getState().currentValue}}]),t}(n.a.Component),y=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).once=!1,r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"previousStep",value:function(e){return e.preventDefault(),this.props.parent.previousStep(),!1}},{key:"render",value:function(){var e=this;console.log(this.props.step);var t=this.props.step.questionNumber/this.props.step.total*100;return 1===this.props.step.questionNumber&&(t=0),n.a.createElement("div",{className:"form__header",ref:function(t){e.nameInput=t,null!==t&&e.props.parent.isScrollHeader()&&t.scrollIntoView()}},n.a.createElement("div",{className:"form__header-title"},n.a.createElement("h3",null,"Step ",this.props.step.sectionNumber,":",n.a.createElement("span",null,this.props.step.section))),n.a.createElement("style",{dangerouslySetInnerHTML:{__html:[".form__header-line:before {","  width: "+t+"%","}"].join("\n")}}),n.a.createElement("div",{className:"form__header-line"}),n.a.createElement("div",{className:"form__header-bottom"},n.a.createElement("a",{className:"form__arrow active",href:"#",onClick:this.previousStep.bind(this)},"back"),n.a.createElement("div",{className:"from__header-number"},n.a.createElement("span",null,this.props.step.questionNumber),"/",this.props.step.total)))}}]),t}(n.a.Component),E=function(e){function t(e){return Object(s.a)(this,t),Object(c.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(o.a)(t,[{key:"submit",value:function(e){return e.preventDefault(),this.props.parent.submit(this.props.parent.value),!1}},{key:"clearForm",value:function(e){e.preventDefault(),this.props.parent.clearForm()}},{key:"render",value:function(){return n.a.createElement("div",{className:"form__footer"},n.a.createElement("a",{className:"form__footer-text",onClick:this.clearForm.bind(this),href:"#",style:{color:"red"}},"Clear all answers"),n.a.createElement("a",{className:"form__btn",onClick:this.submit.bind(this)},"Next"))}}]),t}(n.a.Component);var j=function(e,t){return fetch(window.host+"/launch-api/api/state-store/"+t+"/"+e,{credentials:"include",method:"DELETE",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token}}).then((function(e){return e.json()}))},w=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).props.state.subscribe((function(){return r.props.state.getState()})),r}return Object(u.a)(t,e),Object(o.a)(t,[{key:"onFormSubmit",value:function(e){e.preventDefault(),this.submit(this.currentValue())}},{key:"render",value:function(e){var t=this;this.props.state.subscribe((function(){t.forceUpdate()}));window.config;var r=this.props.state.getState().steps[this.props.state.getState().currentStep];return this.currentStep=r,console.log(r),n.a.createElement("form",{className:"form",onSubmit:this.onFormSubmit.bind(this)},n.a.createElement(y,{step:r,parent:this}),n.a.createElement(g,{state:this.props.state,step:r}),n.a.createElement(E,{step:r,parent:this,state:this.props.state}),n.a.createElement("a",{href:window.config.nextStepUrl,className:"form__footer-text",style:{maxWidth:"120px"}},"Fill the form later"))}},{key:"clearForm",value:function(){var e=this;this.props.state.dispatch({type:"load"}),this.forceUpdate(),j("form",window.userId).then((function(){e.props.state.dispatch({type:"clear"}),e.forceUpdate()}))}},{key:"currentValue",value:function(){return this.props.state.getState().currentValue}},{key:"isScrollHeader",value:function(){var e=this.props.state.getState().isScrollHeader;return void 0!==e&&e}},{key:"previousStep",value:function(){this.props.state.dispatch({type:"previousStep"})}},{key:"submit",value:function(e){this.props.state.dispatch({type:"nextStep",step:this.currentStep,value:e})}}]),t}(n.a.Component),O=r(12);var k=function(e){var t=[],r=0,a=0;for(var n in e)for(var i in a++,e[n].questions){r++;var s=e[n].questions[i];s.section=e[n].title,s.questionNumber=r,s.sectionNumber=a,t.push(s)}var o=t.length;for(var c in t)t[c].total=o;return t};var C=function(e,t,r){return fetch(window.host+"/launch-api/api/state-store",{credentials:"include",method:"PATCH",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token},body:JSON.stringify({data:{type:"state_stores",id:"new",attributes:{type:e,state:r},relationships:{user:{data:{id:t,type:"users"}}}}})}).then((function(e){return e.json()}))};var S=function(e,t){return fetch(window.host+"/formSubmit",{credentials:"include",method:"POST",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token},body:JSON.stringify(t)}).then((function(e){return e.json()}))};var V=function(e){var t={};for(var r in e.steps){var a=e.steps[r].title,n=e.steps[r].name;t[n]={title:a,name:n,value:e.answers[r],stepNumber:r}}return t},_={currentStep:0,steps:k(window.config.questions.steps),answers:[],currentValue:"",error:"",isLoaded:!1};function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_,t=arguments.length>1?arguments[1]:void 0;return function(){var r,a={currentStep:0,steps:k(window.config.questions.steps),answers:[],currentValue:"",error:"",isLoaded:!1};switch(t.type){case"reload":return Object(O.a)({},t.state,{isLoaded:!0});case"load":return Object(O.a)({},e,{isLoaded:!1});case"clear":return Object(O.a)({},a,{isLoaded:!0});case"ready":return Object(O.a)({},e,{isLoaded:!0});case"nextStep":if(r=e.steps[e.currentStep],e.currentValue=void 0===e.currentValue||null===e.currentValue?"":e.currentValue,console.log(t),r.required&&e.currentValue.length<1&&["input","single-choice"].includes(r.type))return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});if(r.required&&"multiple-choice"===r.type&&(null===e.currentValue||0===e.currentValue.length))return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});if(r.required&&"numeric"===r.type&&0===e.currentValue)return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});var n=e.currentStep+1;if(console.log(n,e.currentStep,e),e.answers[e.currentStep]=e.currentValue,n===r.total)return S(window.userId,V(e)).then((function(){window.location.href=window.config.lastStep})),Object(O.a)({},e,{isLoaded:!1,stopApp:!0});var i=e.steps[n];return void 0===e.answers[n]&&(e.currentValue={input:"","single-choice":[],"multiple-choice":[],numeric:void 0!==i.predefinedValue?i.predefinedValue:0}[i.type]),void 0!==e.answers[n]&&e.answers[n].length>0&&(e.currentValue=e.answers[n]),e=Object(O.a)({},e,{currentStep:n,error:"",isScrollHeader:!0}),C("form",window.userId,e),e;case"previousStep":if(0===e.currentStep)return e;var s=e.currentStep-1;return Object(O.a)({},e,{currentStep:s,currentValue:e.answers[s],error:"",isScrollHeader:!0});case"changeCurrentValue":return e=Object(O.a)({},e,{currentValue:t.currentValue,isScrollHeader:!1});case"submitSingleChoice":e.answers[e.currentStep]=t.variant.value,r=e.steps[e.currentStep];var o=(e=Object(O.a)({},e,{currentStep:e.currentStep+1,error:""})).currentStep+1;return console.log(o,r.total),o===r.total?(S(window.userId,V(e)).then((function(){window.location.href=window.config.lastStep})),Object(O.a)({},e,{isLoaded:!1,stopApp:!0,isScrollHeader:!0})):(C("form",window.userId,e),e);default:return e}}()}var x=r(88);var q=function(e,t){return fetch(window.host+"/launch-api/api/state-store/"+t+"/"+e,{credentials:"include",method:"GET",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token}}).then((function(e){return e.json()}))},M=function(e){function t(e){var r;return Object(s.a)(this,t),(r=Object(c.a)(this,Object(l.a)(t).call(this,e))).initialState={},r.state=Object(x.a)(N),r.state.subscribe((function(){r.forceUpdate()})),r.state.getState().stopApp?Object(c.a)(r):(q("form",window.userId).then((function(e){if("undefined"===typeof e.data)return r.state.dispatch({type:"ready"}),void r.forceUpdate();r.state.dispatch({type:"reload",state:e.data.attributes.state}),r.forceUpdate()})),r)}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){return this.state.getState().isLoaded?n.a.createElement("div",null,n.a.createElement(w,{state:this.state,parent:this})):n.a.createElement("div",{className:"wait-spinner"},n.a.createElement("div",{className:"lds-roller"},n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null)))}}]),t}(n.a.Component);window.api||(window.api="http://localhost:904/api/v1/"),Object(i.render)(n.a.createElement(M,null),document.getElementById("root"))},89:function(e,t,r){e.exports=r(184)}},[[89,1,2]]]);
//# sourceMappingURL=main.51c3cde7.chunk.js.map