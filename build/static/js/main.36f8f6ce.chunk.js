(this.webpackJsonptodos=this.webpackJsonptodos||[]).push([[0],{184:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),i=a(86),s=a(6),c=a(7),o=a(4),l=a(8),u=a(9),p=a(13),h=function(e){function t(e){return Object(s.a)(this,t),Object(o.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.error.length<1?n.a.createElement("div",null):n.a.createElement("div",{className:"form__text-error active"},n.a.createElement("span",null,"!"),this.props.error)}}]),t}(n.a.Component),d=function(e){function t(e){return Object(s.a)(this,t),Object(o.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e;return"numeric"===this.props.step.type&&(e="Tip: lick on the number to edit manually"),n.a.createElement("div",{className:"form__main-title"},n.a.createElement("h2",null,this.props.step.title,n.a.createElement("span",{style:this.props.step.required?{}:{fontSize:"10px"}},this.props.step.required?"*":"(optional)"),n.a.createElement("div",{style:{fontSize:"12px",color:"#CCC"}},e)))}}]),t}(n.a.Component),m=function(e){function t(e){var a;Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(p.a)(a));a.props.config.variants;var r=a.props.parent.getCurrentValue();return null!==r&&r.length>0&&(a.props.config.variants=a.props.config.variants.reduce((function(e,t){return t.checked=r===t.value,t.showMyVariant=!1,console.log(t,r),void 0!==t.title&&(t.showMyVariant=r===t.value),e.push(t),e}),[])),a.forceUpdate(),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handleOnClick",value:function(e){var t=this;if(null!==e.value&&!e.custom)return this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.value}),void this.props.parent.dispatch({type:"nextStep",step:this.props.config,value:e.value});this.props.config.variants;this.props.config.variants=this.props.config.variants.reduce((function(a,r){return r.showMyVariant?(r.value="",r.showMyVariant=!1,a.push(r),a):r.title===e.title&&!e.showMyVariant&&e.custom?(r.checked=!0,r.showMyVariant=!0,r.value="",a.push(r),t.props.parent.dispatch({type:"changeCurrentValue",currentValue:""}),a):(r.checked=e.value===r.value,a.push(r),a)}),[]),this.forceUpdate()}},{key:"handleChange",value:function(e){this.props.config.variants=this.props.config.variants.reduce((function(t,a){return void 0!==a.title&&(a.value=e.target.value),t.push(a),t}),[]),this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return console.log(this.props.config),n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},n.a.createElement("div",{className:"from__group-radio"},this.props.config.variants.map((function(t){return console.log(void 0!==t.showMyVariant&&!1!==t.showMyVariant),n.a.createElement("div",null,n.a.createElement("input",{checked:t.checked,type:"radio",value:t.value,name:t.title,id:t.title}),n.a.createElement("label",{onClick:function(){return e.handleOnClick(t)},htmlFor:t.title},void 0!==t.custom?t.title:t.value),n.a.createElement("input",{onChange:e.handleChange,value:e.props.parent.getCurrentValue(),style:void 0!==t.showMyVariant&&!1!==t.showMyVariant?{display:"block"}:{display:"none"},type:"text",placeholder:"My variant"}))})))),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),f=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.nameInput.focus()}},{key:"handleChange",value:function(e){this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},n.a.createElement("input",{ref:function(t){e.nameInput=t,null!==t&&t.focus()},type:"text",onChange:this.handleChange,placeholder:this.props.config.placeholder,value:this.props.parent.getCurrentValue()})),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),v=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){this.props.config.variants=this.props.config.variants.reduce((function(t,a){return void 0!==a.title&&a.custom&&(a.value=e.target.value),t.push(a),t}),[]),this.forceUpdate()}},{key:"handleOnClick",value:function(e){var t=this,a=[];this.props.config.variants=this.props.config.variants.reduce((function(r,n){return e.value===n.value&&n.checked?(e.custom&&(t.myVariant="",e.showMyVariant=!1),n.checked=0,r.push(n),r):(n.checked&&a.push(n.value),e.value===n.value?(n.checked=1,void 0!==n.custom&&n.custom&&e.custom&&n.checked&&(n.showMyVariant=!0),a.push(n.value),r.push(n),r):(r.push(n),r))}),[]),console.log(a),this.props.parent.dispatch({type:"changeCurrentValue",currentValue:a}),this.forceUpdate()}},{key:"render",value:function(){var e=this;return console.log(this.props.config),n.a.createElement("div",{className:"form__main"}," ",n.a.createElement("div",{className:"form__main-text"},n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement("span",null,"*")," - Required"))),n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group"},this.props.config.variants.map((function(t){var a;return n.a.createElement("div",{className:"from__group-radio"},n.a.createElement("input",{checked:t.checked,type:"checkbox",value:t.value,name:t.title,id:t.value}),n.a.createElement("label",{onClick:function(){return e.handleOnClick(t)},htmlFor:t.title},void 0!==t.custom?t.title:t.value),n.a.createElement("input",{onChange:e.handleChange,value:null!==(a=t.value)&&void 0!==a?a:"",style:void 0!==t.showMyVariant&&!1!==t.showMyVariant?{display:"block"}:{display:"none"},type:"text",placeholder:"My variant"}))}))),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),b=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).handleChange=a.handleChange.bind(Object(p.a)(a)),a.increment=a.increment.bind(Object(p.a)(a)),a.decrement=a.decrement.bind(Object(p.a)(a)),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"handleChange",value:function(e){this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e.target.value}),this.forceUpdate()}},{key:"increment",value:function(){this.props.parent.dispatch({type:"changeCurrentValue",currentValue:this.props.parent.getCurrentValue()+1}),this.forceUpdate()}},{key:"decrement",value:function(){var e=this.props.parent.getCurrentValue();e<=0||(this.props.parent.dispatch({type:"changeCurrentValue",currentValue:e-1}),this.forceUpdate())}},{key:"render",value:function(){var e=this;return n.a.createElement("div",null,n.a.createElement(d,{step:this.props.config}),n.a.createElement("div",{className:"form__group form__group--calc"},n.a.createElement("button",{className:"form__btn-calc",onClick:this.decrement,type:"button"},"-"),n.a.createElement("input",{ref:function(t){e.nameInput=t,null!==t&&t.focus()},className:"form__input-calc",type:"text",onChange:this.handleChange,value:this.props.parent.getCurrentValue()}),n.a.createElement("button",{className:"form__btn-calc",onClick:this.increment,type:"button"},"+")),n.a.createElement(h,{error:this.props.parent.getError()}))}}]),t}(n.a.Component),g=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).value="",a.props.state.subscribe((function(){return a.props.state.getState()})),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(e){var t,a=this.props.step;switch(a.type){case"input":t=n.a.createElement(f,{config:a,parent:this});break;case"single-choice":t=n.a.createElement(m,{config:a,parent:this});break;case"multiple-choice":t=n.a.createElement(v,{config:a,parent:this});break;case"numeric":t=n.a.createElement(b,{config:a,parent:this})}return n.a.createElement("div",null,t)}},{key:"getError",value:function(){return this.props.state.getState().error}},{key:"dispatch",value:function(e){this.props.state.dispatch(e)}},{key:"getCurrentValue",value:function(){return this.props.state.getState().currentValue}}]),t}(n.a.Component),y=function(e){function t(e){return Object(s.a)(this,t),Object(o.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"previousStep",value:function(e){return e.preventDefault(),this.props.parent.previousStep(),!1}},{key:"render",value:function(){console.log(this.props.step);var e=this.props.step.questionNumber/this.props.step.total*100;return 1===this.props.step.questionNumber&&(e=0),n.a.createElement("div",{className:"form__header"},n.a.createElement("div",{className:"form__header-title"},n.a.createElement("h3",null,"Step ",this.props.step.sectionNumber,":",n.a.createElement("span",null,this.props.step.section))),n.a.createElement("style",{dangerouslySetInnerHTML:{__html:[".form__header-line:before {","  width: "+e+"%","}"].join("\n")}}),n.a.createElement("div",{className:"form__header-line"}),n.a.createElement("div",{className:"form__header-bottom"},n.a.createElement("a",{className:"form__arrow active",href:"#",onClick:this.previousStep.bind(this)},"back"),n.a.createElement("div",{className:"from__header-number"},n.a.createElement("span",null,this.props.step.questionNumber),"/",this.props.step.total)))}}]),t}(n.a.Component),E=function(e){function t(e){return Object(s.a)(this,t),Object(o.a)(this,Object(l.a)(t).call(this,e))}return Object(u.a)(t,e),Object(c.a)(t,[{key:"submit",value:function(e){return e.preventDefault(),this.props.parent.submit(this.props.parent.value),!1}},{key:"clearForm",value:function(e){e.preventDefault(),this.props.parent.clearForm()}},{key:"render",value:function(){return n.a.createElement("div",{className:"form__footer"},n.a.createElement("a",{className:"form__footer-text",onClick:this.clearForm.bind(this),href:"#",style:{color:"red"}},"Clear all answers"),n.a.createElement("a",{className:"form__btn",onClick:this.submit.bind(this)},"Next"))}}]),t}(n.a.Component);var j=function(e,t){return fetch(window.host+"/launch-api/api/state-store/"+t+"/"+e,{credentials:"include",method:"DELETE",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token}}).then((function(e){return e.json()}))},w=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).props.state.subscribe((function(){return a.props.state.getState()})),a}return Object(u.a)(t,e),Object(c.a)(t,[{key:"onFormSubmit",value:function(e){e.preventDefault(),this.submit(this.currentValue())}},{key:"render",value:function(e){var t=this;this.props.state.subscribe((function(){t.forceUpdate()}));window.config;var a=this.props.state.getState().steps[this.props.state.getState().currentStep];return this.currentStep=a,console.log(a),n.a.createElement("form",{className:"form",onSubmit:this.onFormSubmit.bind(this)},n.a.createElement(y,{step:a,parent:this}),n.a.createElement(g,{state:this.props.state,step:a}),n.a.createElement(E,{step:a,parent:this,state:this.props.state}),n.a.createElement("a",{href:window.config.nextStepUrl,className:"form__footer-text",style:{maxWidth:"120px"}},"Fill the form later"))}},{key:"clearForm",value:function(){var e=this;this.props.state.dispatch({type:"load"}),this.forceUpdate(),j("form",window.userId).then((function(){e.props.state.dispatch({type:"clear"}),e.forceUpdate()}))}},{key:"currentValue",value:function(){return this.props.state.getState().currentValue}},{key:"previousStep",value:function(){this.props.state.dispatch({type:"previousStep"})}},{key:"submit",value:function(e){this.props.state.dispatch({type:"nextStep",step:this.currentStep,value:e})}}]),t}(n.a.Component),O=a(12);var k=function(e){var t=[],a=0,r=0;for(var n in e)for(var i in r++,e[n].questions){a++;var s=e[n].questions[i];s.section=e[n].title,s.questionNumber=a,s.sectionNumber=r,t.push(s)}var c=t.length;for(var o in t)t[o].total=c;return t};var C=function(e,t,a){return fetch(window.host+"/launch-api/api/state-store",{credentials:"include",method:"PATCH",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token},body:JSON.stringify({data:{type:"state_stores",id:"new",attributes:{type:e,state:a},relationships:{user:{data:{id:t,type:"users"}}}}})}).then((function(e){return e.json()}))};var _=function(e,t){return fetch(window.host+"/formSubmit",{credentials:"include",method:"POST",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token},body:JSON.stringify(t)}).then((function(e){return e.json()}))};var V=function(e){var t={};for(var a in e.steps){var r=e.steps[a].title,n=e.steps[a].name;t[n]={title:r,name:n,value:e.answers[a],stepNumber:a}}return t},S={currentStep:0,steps:k(window.config.questions.steps),answers:[],currentValue:"",error:"",isLoaded:!1};function N(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:S,t=arguments.length>1?arguments[1]:void 0;return function(){var a,r={currentStep:0,steps:k(window.config.questions.steps),answers:[],currentValue:"",error:"",isLoaded:!1};switch(t.type){case"reload":return Object(O.a)({},t.state,{isLoaded:!0});case"load":return Object(O.a)({},e,{isLoaded:!1});case"clear":return Object(O.a)({},r,{isLoaded:!0});case"ready":return Object(O.a)({},e,{isLoaded:!0});case"nextStep":if(a=e.steps[e.currentStep],e.currentValue=void 0===e.currentValue||null===e.currentValue?"":e.currentValue,console.log(t),a.required&&e.currentValue.length<1&&["input","single-choice"].includes(a.type))return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});if(a.required&&"multiple-choice"===a.type&&(null===e.currentValue||0===e.currentValue.length))return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});if(a.required&&"numeric"===a.type&&0===e.currentValue)return Object(O.a)({},e,{currentStep:e.currentStep,error:"This field is required"});var n=e.currentStep+1;if(console.log(n,e.currentStep,e),n===a.total)return _(window.userId,V(e)).then((function(){window.location.href=window.config.lastStep})),Object(O.a)({},e,{isLoaded:!1,stopApp:!0});var i=e.steps[n];return e.answers[e.currentStep]=e.currentValue,void 0===e.answers[n]&&(e.currentValue={input:"","single-choice":[],"multiple-choice":[],numeric:void 0!==i.predefinedValue?i.predefinedValue:0}[i.type]),e=Object(O.a)({},e,{currentStep:n,error:""}),C("form",window.userId,e),e;case"previousStep":if(0===e.currentStep)return e;var s=e.currentStep-1;return Object(O.a)({},e,{currentStep:s,currentValue:e.answers[s],error:""});case"changeCurrentValue":return e=Object(O.a)({},e,{currentValue:t.currentValue});case"submitSingleChoice":e.answers[e.currentStep]=t.variant.value,a=e.steps[e.currentStep];var c=(e=Object(O.a)({},e,{currentStep:e.currentStep+1,error:""})).currentStep+1;return console.log(c,a.total),c===a.total?(_(window.userId,V(e)).then((function(){window.location.href=window.config.lastStep})),Object(O.a)({},e,{isLoaded:!1,stopApp:!0})):(C("form",window.userId,e),e);default:return e}}()}var x=a(88);var q=function(e,t){return fetch(window.host+"/launch-api/api/state-store/"+t+"/"+e,{credentials:"include",method:"GET",mode:"cors",redirect:"follow",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:window.token}}).then((function(e){return e.json()}))},M=function(e){function t(e){var a;return Object(s.a)(this,t),(a=Object(o.a)(this,Object(l.a)(t).call(this,e))).initialState={},a.state=Object(x.a)(N),a.state.subscribe((function(){a.forceUpdate()})),a.state.getState().stopApp?Object(o.a)(a):(q("form",window.userId).then((function(e){if("undefined"===typeof e.data)return a.state.dispatch({type:"ready"}),void a.forceUpdate();a.state.dispatch({type:"reload",state:e.data.attributes.state}),a.forceUpdate()})),a)}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.getState().isLoaded?n.a.createElement("div",null,n.a.createElement(w,{state:this.state,parent:this})):n.a.createElement("div",{className:"wait-spinner"},n.a.createElement("div",{className:"lds-roller"},n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null),n.a.createElement("div",null)))}}]),t}(n.a.Component);window.api||(window.api="http://localhost:904/api/v1/"),Object(i.render)(n.a.createElement(M,null),document.getElementById("root"))},89:function(e,t,a){e.exports=a(184)}},[[89,1,2]]]);
//# sourceMappingURL=main.36f8f6ce.chunk.js.map